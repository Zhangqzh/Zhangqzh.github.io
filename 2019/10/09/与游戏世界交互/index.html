<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>与游戏世界交互 | ZZ blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Rica Zhang">
  <meta name="keywords" content="ZZ, ZZ Blog, �ō���Ĳ���">
  <meta name="description" content="Whatever will be, will be.">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'Lx',
    version: '1.4.5',
    localsearch:{
      "enable": false,
      "trigger": "auto",
      "top_n_per_article": 1,
      "unescape": false,
      "preload": false
      },
    path: '-'
  };
</script>

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/jquery.min.js"></script>
  <script src="/js/jquery.jside.menu.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "endless-river",
	     });
	}); 
	</script>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300|Noto+Serif+SC&amp;display=swap">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
</head>
<body>
<div class="single">
<div id="page">
<div id="lx-aside" style="background-image: url(/images/page-cover.jpg)" data-stellar-background-ratio="0.5">
  <div class="overlay">
  <div class="page-title">
    <div class="avatar"><a href="/"><img src="/images/person_1.jpg"></a></div>
    <span>2019-10-09</span>
    <h2>与游戏世界交互</h2>
    
    </div>
</div>
</div>
<div id="lx-main-content">
  <div class="lx-post">
    <div class="lx-entry padding">
      <div>
        <h2 id="一-游戏内容要求："><a href="#一-游戏内容要求：" class="headerlink" title="一.游戏内容要求："></a>一.游戏内容要求：</h2><ul>
<li>游戏有 n 个 round，每个 round 都包括10 次 trial；</li>
<li>每个 trial 的飞碟的色彩、大小、发射位置、速度、角度、同时出现的个数都可能不同。它们由该 round 的 ruler 控制；</li>
<li>每个 trial 的飞碟有随机性，总体难度随 round 上升；</li>
<li>鼠标点中得分，得分规则按色彩、大小、速度不同计算，规则可自由设定。</li>
<li>使用带缓存的工厂模式管理不同飞碟的生产与回收，该工厂必须是场景单实例的！具体实现见参考资源 Singleton 模板类</li>
<li>近可能使用前面 MVC 结构实现人机交互与游戏模型分离<h2 id="二-游戏实现"><a href="#二-游戏实现" class="headerlink" title="二.游戏实现"></a>二.游戏实现</h2><h3 id="游戏架构"><a href="#游戏架构" class="headerlink" title="游戏架构"></a>游戏架构</h3></li>
<li>Director：游戏的导演</li>
<li>FirstSceneController：总控制器</li>
<li>ActionManager：动作管理者，负责管理动作的产生</li>
<li>UserGUI：负责渲染整个页面的布局，主要是功能按钮的实现</li>
<li>ScoreRecorder：负责分数的计算，根据飞碟的大小，速度，颜色，计算打中的得分</li>
<li>DiskDate：挂在飞碟预制上的组件，规定了飞碟的属性</li>
<li>DiskFactory：负责生产不同大小，速度，颜色的飞碟<h3 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h3><img src="https://www.z4a.net/images/2019/10/09/TIM20191009194057.png" alt><h3 id="预制和挂载信息"><a href="#预制和挂载信息" class="headerlink" title="预制和挂载信息"></a>预制和挂载信息</h3><img src="https://www.z4a.net/images/2019/10/09/TIM20191009195353.png" alt><br><img src="https://www.z4a.net/images/2019/10/09/_20191009195410.png" alt><br>预制Disk，要把DiskData挂载在上面<br><img src="https://www.z4a.net/images/2019/10/09/TIM20191009195441.png" alt><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3>场景单实例要求场景中至少有一个 T 类型的 Mono 子类Singleton模板代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Singleton&lt;T&gt; where T : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    private static T instance;</span><br><span class="line"></span><br><span class="line">    public static T Instance</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            if (instance == null)</span><br><span class="line">            &#123;</span><br><span class="line">                instance = (T)Object.FindObjectOfType(typeof(T));</span><br><span class="line">                if (instance == null)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.LogError(&quot;Can&apos;t find instance of &quot; + typeof(T));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>DiskData记录每个飞碟自身的数据  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class DiskData : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public Vector3 direction; // 飞碟的初始位置</span><br><span class="line">    public Vector3 scale;     // 飞碟的相对大小</span><br><span class="line">    public Color color;       // 飞碟的颜色</span><br><span class="line">    public float speed;       // 飞碟的飞行速度</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>飞碟工厂DiskFactory<br>有两个链表，分别存储使用和闲置的飞碟，可以避免飞碟的销毁和过多加载  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class DiskFactory : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public GameObject diskPrefab = null;                // 飞碟预制，是工厂返回的对象</span><br><span class="line">    private List&lt;DiskData&gt; used = new List&lt;DiskData&gt;(); // 正在使用的飞碟</span><br><span class="line">    private List&lt;DiskData&gt; free = new List&lt;DiskData&gt;(); // 未在使用的飞碟</span><br><span class="line"></span><br><span class="line">    // 获取飞碟</span><br><span class="line">    public GameObject GetDisk(int round)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        int choice = 0; // 决定飞碟种类的变量</span><br><span class="line">        diskPrefab = null;</span><br><span class="line"></span><br><span class="line">        // 若存在正在使用的飞碟，则从 used 列表中获取；若不存在，则新建飞碟</span><br><span class="line">        if (free.Count &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">            diskPrefab = free[0].gameObject;</span><br><span class="line">            free.Remove(free[0]);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            diskPrefab = GameObject.Instantiate&lt;GameObject&gt;(Resources.Load&lt;GameObject&gt;(&quot;Prefabs/Disk&quot;), Vector3.zero, Quaternion.identity);</span><br><span class="line">            diskPrefab.SetActive(false);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 根据回合随机选出飞碟种类</span><br><span class="line">        switch (round)</span><br><span class="line">        &#123;</span><br><span class="line">            case 1:</span><br><span class="line">                choice = Random.Range(0, 2);</span><br><span class="line">                break;</span><br><span class="line">            case 2:</span><br><span class="line">                choice = Random.Range(0, 4);</span><br><span class="line">                break;</span><br><span class="line">            case 3:</span><br><span class="line">                choice = Random.Range(0, 8);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        // 设置不同种类飞碟的属性</span><br><span class="line">        if (choice &lt; 2)</span><br><span class="line">        &#123;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().color = Color.yellow;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().speed = 7.0f + round;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().scale = new Vector3(4, 0.2f, 4);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (choice &gt; 2 &amp;&amp; choice &lt; 4)</span><br><span class="line">        &#123;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().color = Color.red;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().speed = 9.0f + round;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().scale = new Vector3(2, 0.1f, 2);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (choice &gt; 4)</span><br><span class="line">        &#123;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().color = Color.white;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().speed = 11.0f + round;</span><br><span class="line">            diskPrefab.GetComponent&lt;DiskData&gt;().scale = new Vector3(1, 0.05f, 1);</span><br><span class="line">        &#125;</span><br><span class="line">        float RanX = Random.Range(-1f, 1f) &lt; 0 ? -1 : 1;</span><br><span class="line">        diskPrefab.GetComponent&lt;DiskData&gt;().direction = new Vector3(RanX, 1, 0);</span><br><span class="line">        diskPrefab.transform.localScale = diskPrefab.GetComponent&lt;DiskData&gt;().scale;</span><br><span class="line">        diskPrefab.GetComponent&lt;Renderer&gt;().material.color = diskPrefab.GetComponent&lt;DiskData&gt;().color;</span><br><span class="line"></span><br><span class="line">        // 将飞碟添加到 used 列表并返回</span><br><span class="line">        used.Add(diskPrefab.GetComponent&lt;DiskData&gt;());</span><br><span class="line">        diskPrefab.name = diskPrefab.GetInstanceID().ToString();</span><br><span class="line">        return diskPrefab;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 回收飞碟</span><br><span class="line">    public void FreeDisk(GameObject disk)</span><br><span class="line">    &#123;</span><br><span class="line">        foreach (DiskData data in used)</span><br><span class="line">        &#123;</span><br><span class="line">            if (data.gameObject.GetInstanceID() == disk.GetInstanceID())</span><br><span class="line">            &#123;</span><br><span class="line">                data.gameObject.SetActive(false);</span><br><span class="line">                free.Add(data);</span><br><span class="line">                used.Remove(data);</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>记分员ScoreRecorder根据飞碟大小和颜色计分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class ScoreRecorder : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public int score; // 分数</span><br><span class="line"></span><br><span class="line">    private Dictionary&lt;Color, int&gt; scoreTable = new Dictionary&lt;Color, int&gt;(); // 用字典来记录不同飞碟对应的分数</span><br><span class="line"></span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        score = 0;</span><br><span class="line">        scoreTable.Add(Color.yellow, 1);</span><br><span class="line">        scoreTable.Add(Color.red, 2);</span><br><span class="line">        scoreTable.Add(Color.white, 4);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 记录分数的增加</span><br><span class="line">    public void Record(GameObject disk)</span><br><span class="line">    &#123;</span><br><span class="line">        score += scoreTable[disk.GetComponent&lt;DiskData&gt;().color];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Reset()</span><br><span class="line">    &#123;</span><br><span class="line">        score = 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FirstSceneController场记每秒从飞碟工厂得到一只飞碟，然后让动作管理者发射，让记分员计分，每一帧检查遗留在场景的飞碟，再让飞碟工厂回收  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class FirstSceneController : MonoBehaviour, SceneController, UserAction</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public FlyActionManager actionManager;</span><br><span class="line">    public DiskFactory diskFactory;</span><br><span class="line">    public UserGUI userGUI;</span><br><span class="line">    public ScoreRecorder scoreRecorder;</span><br><span class="line"></span><br><span class="line">    private Queue&lt;GameObject&gt; diskQueue = new Queue&lt;GameObject&gt;(); // 游戏中的飞碟</span><br><span class="line">    private List&lt;GameObject&gt; diskNotshot = new List&lt;GameObject&gt;(); // 未被击中的飞碟</span><br><span class="line">    private int diskNumber;                                        // 每个回合的飞碟数量</span><br><span class="line">    private int currentRound;                                       //当前回合</span><br><span class="line">    private int roundNumber;                                       // 回合总数</span><br><span class="line">    private float frequency;                                       // 飞碟出现的频率</span><br><span class="line">    private GameState gameState = GameState.PAUSE;                 // 游戏状态</span><br><span class="line"></span><br><span class="line">    // 场景初始化</span><br><span class="line">    void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        Director director = Director.getInstance();</span><br><span class="line">        director.currentSceneController = this;</span><br><span class="line">        diskNumber = 10;</span><br><span class="line">        currentRound = 1;</span><br><span class="line">        roundNumber = 3;</span><br><span class="line">        frequency = 2f;</span><br><span class="line">        scoreRecorder = Singleton&lt;ScoreRecorder&gt;.Instance;</span><br><span class="line">        diskFactory = Singleton&lt;DiskFactory&gt;.Instance;</span><br><span class="line">        actionManager = gameObject.AddComponent&lt;FlyActionManager&gt;();</span><br><span class="line">        userGUI = gameObject.AddComponent&lt;UserGUI&gt;() as UserGUI;</span><br><span class="line">        director.setFPS(60);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 将飞碟加载到飞碟队列中</span><br><span class="line">    public void LoadResources()</span><br><span class="line">    &#123;</span><br><span class="line">        diskQueue.Enqueue(diskFactory.GetDisk(currentRound));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void Update()</span><br><span class="line">    &#123;</span><br><span class="line">        // 判断回合结束</span><br><span class="line">        if (diskNumber == 0 &amp;&amp; currentRound &lt; roundNumber)</span><br><span class="line">        &#123;</span><br><span class="line">            CancelInvoke(&quot;LoadResources&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // 判断游戏结束</span><br><span class="line">        if (diskNumber == 0 &amp;&amp; currentRound == roundNumber)</span><br><span class="line">        &#123;</span><br><span class="line">            gameState = GameState.FINISH;</span><br><span class="line">        &#125;</span><br><span class="line">        else if (diskNumber == 0 &amp;&amp; diskNotshot.Count == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            diskNumber = 10;</span><br><span class="line">            frequency -= 0.4f;</span><br><span class="line">            gameState = GameState.ROUND_FINISH;</span><br><span class="line">        &#125;</span><br><span class="line">        // 游戏开始时加载飞碟资源</span><br><span class="line">        if (gameState == GameState.START)</span><br><span class="line">        &#123;</span><br><span class="line">            InvokeRepeating(&quot;LoadResources&quot;, 1f, frequency);</span><br><span class="line">            gameState = GameState.ROUND_START;</span><br><span class="line">        &#125;</span><br><span class="line">        // 游戏暂停或结束时取消加载飞碟资源</span><br><span class="line">        if (gameState == GameState.FINISH || gameState == GameState.ROUND_FINISH || gameState == GameState.PAUSE)</span><br><span class="line">        &#123;</span><br><span class="line">            CancelInvoke(&quot;LoadResources&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // 回合开始，抛出飞碟</span><br><span class="line">        if (gameState == GameState.ROUND_START)</span><br><span class="line">            ThrowDisk();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 抛出飞碟</span><br><span class="line">    public void ThrowDisk()</span><br><span class="line">    &#123;</span><br><span class="line">        float position_x = 16;</span><br><span class="line">        if (diskQueue.Count != 0)</span><br><span class="line">        &#123;</span><br><span class="line">            diskNumber--;</span><br><span class="line">            GameObject disk = diskQueue.Dequeue(); // 取出飞碟</span><br><span class="line">            diskNotshot.Add(disk);</span><br><span class="line">            disk.SetActive(true);</span><br><span class="line"></span><br><span class="line">            // 设置飞碟的随机位置</span><br><span class="line">            float ran_y = Random.Range(1f, 4f);</span><br><span class="line">            float ran_x = Random.Range(-1f, 1f) &lt; 0 ? -1 : 1;</span><br><span class="line">            disk.GetComponent&lt;DiskData&gt;().direction = new Vector3(ran_x, ran_y, 0);</span><br><span class="line">            Vector3 position = new Vector3(-disk.GetComponent&lt;DiskData&gt;().direction.x * position_x, ran_y, 0);</span><br><span class="line">            disk.transform.position = position;</span><br><span class="line"></span><br><span class="line">            // 设置飞碟初始所受的力和角度</span><br><span class="line">            float power = Random.Range(10f, 15f);</span><br><span class="line">            float angle = Random.Range(15f, 28f);</span><br><span class="line">            actionManager.Fly(disk, angle, power);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; diskNotshot.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            GameObject temp = diskNotshot[i];</span><br><span class="line">            //飞碟飞出摄像机视野也没被打中</span><br><span class="line">            if (temp.transform.position.y &lt; -20 &amp;&amp; temp.gameObject.activeSelf == true)</span><br><span class="line">            &#123;</span><br><span class="line">                diskFactory.FreeDisk(diskNotshot[i]);</span><br><span class="line">                diskNotshot.Remove(diskNotshot[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 击中飞碟</span><br><span class="line">    public void Hit(Vector3 position)</span><br><span class="line">    &#123;</span><br><span class="line">        Ray ray = Camera.main.ScreenPointToRay(position);</span><br><span class="line">        RaycastHit[] hits;</span><br><span class="line">        hits = Physics.RaycastAll(ray);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; hits.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RaycastHit hit = hits[i];</span><br><span class="line">            if (hit.collider.gameObject.GetComponent&lt;DiskData&gt;() != null)</span><br><span class="line">            &#123;</span><br><span class="line">                scoreRecorder.Record(hit.collider.gameObject); // 按照飞碟种类计分</span><br><span class="line">                hit.collider.gameObject.transform.position = new Vector3(0, -20, 0); // 将飞碟移到底部</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取分数</span><br><span class="line">    public int GetScore()</span><br><span class="line">    &#123;</span><br><span class="line">        return scoreRecorder.score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 重新开始</span><br><span class="line">    public void Restart()</span><br><span class="line">    &#123;</span><br><span class="line">        gameState = GameState.START;</span><br><span class="line">        scoreRecorder.Reset();</span><br><span class="line">        currentRound = 1;</span><br><span class="line">        diskNumber = 10;</span><br><span class="line">        frequency = 2f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 暂停游戏</span><br><span class="line">    public void Pause()</span><br><span class="line">    &#123;</span><br><span class="line">        gameState = GameState.PAUSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 开始游戏</span><br><span class="line">    public void Begin()</span><br><span class="line">    &#123;</span><br><span class="line">        gameState = GameState.START;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 开始下一回合</span><br><span class="line">    public void NextRound()</span><br><span class="line">    &#123;</span><br><span class="line">        gameState = GameState.START;</span><br><span class="line">        currentRound++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取游戏状态</span><br><span class="line">    public GameState getGameState()</span><br><span class="line">    &#123;</span><br><span class="line">        return gameState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 设置游戏状态</span><br><span class="line">    public void setGameState(GameState gs)</span><br><span class="line">    &#123;</span><br><span class="line">        gameState = gs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取回合</span><br><span class="line">    public int GetRound()</span><br><span class="line">    &#123;</span><br><span class="line">        return this.currentRound;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 暂停几秒后回收飞碟</span><br><span class="line">    IEnumerator WaitingParticle(float wait_time, RaycastHit hit, DiskFactory disk_factory, GameObject obj)</span><br><span class="line">    &#123;</span><br><span class="line">        yield return new WaitForSeconds(wait_time);</span><br><span class="line">        // 等待之后执行的动作  </span><br><span class="line">        hit.collider.gameObject.transform.position = new Vector3(0, -20, 0);</span><br><span class="line">        disk_factory.FreeDisk(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>导演类Director</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">// 导演类采用单例模式</span><br><span class="line">public class Director : System.Object</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    private static Director _instance; // 导演的实例</span><br><span class="line">    public SceneController currentSceneController &#123; get; set; &#125; // 当前的场记</span><br><span class="line"></span><br><span class="line">    private Director() &#123; &#125;</span><br><span class="line"></span><br><span class="line">    // 获取导演实例</span><br><span class="line">    public static Director getInstance()</span><br><span class="line">    &#123;</span><br><span class="line">        if (_instance == null)</span><br><span class="line">        &#123;</span><br><span class="line">            _instance = new Director();</span><br><span class="line">        &#125;</span><br><span class="line">        return _instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getFPS()</span><br><span class="line">    &#123;</span><br><span class="line">        return Application.targetFrameRate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFPS(int fps)</span><br><span class="line">    &#123;</span><br><span class="line">        Application.targetFrameRate = fps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码并不完整</p>
<h2 id="三-演示视频"><a href="#三-演示视频" class="headerlink" title="三.演示视频"></a>三.演示视频</h2><p><a href="https://www.bilibili.com/video/av70663160" target="_blank" rel="noopener">https://www.bilibili.com/video/av70663160</a></p>

      </div>
    </div>
  </div>
</div>
<div class="lx-navigation">
	<div class="lx-cover prev lx-cover-sm" style="background-image: url(/images/footer_1.jpg)">
		<div class="overlay"></div>
		<a class="copy" href="#">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Next</span>
						<h3>没有更新的文章</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
        <div class="lx-cover next lx-cover-sm" style="background-image: url(/images/footer_2.jpg)">
		<div class="overlay"></div>
		<a class="copy" href="/2019/10/07/CLI/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Prev</span>
						<h3>CLI</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
</div>
</div>

<footer>
  <div>
  Copyright &copy; 2019.<a href="/">ZZ blog</a><br>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.blleng.cn" target="_blank">Lx</a><br>
  </div>
</footer>
</div>

<button class="menu-trigger"></button>
<div class="menu">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="/images/person_1.jpg" alt="Rica Zhang"></a>
          </div>
        </div>
        <div class="row for-name">
          <p>Rica Zhang</p>
          <span class="tagline">Hello, World!</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>首页</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>归档</a></li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-bookmark fa-fw"></i>页面</span>
        <ul>
          <li><a href="/guestbook">留言</a></li>
        <li><a href="/about">关于</a></li>
        </ul>
    </li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-link fa-fw"></i>友链</span>
        <ul>
          <li> <a href="https://lx.blleng.cn" target="_blank">Theme-Lx</a></li>
        </ul>
    </li>
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="/js/jquery.easing.min.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.stellar.min.js"></script>
<script src="/js/main.js"></script>


</body>
</html>
